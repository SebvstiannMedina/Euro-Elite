{% extends 'base.html' %}
{% load static %}
{% block title %}Compra exitosa - Euro Elite{% endblock %}
{% block content %}

<br>
<br>
<br>
<br>
<br>
<br>

<div class="container my-4">
  <div class="row justify-content-center">
    <div class="col-12 col-lg-8">
      <!-- Mensaje principal de éxito -->
      <div class="card shadow-sm p-4 text-center success-card">
        <div class="success-icon mx-auto mb-3">
          <i class="fa-solid fa-check"></i>
        </div>
        <h2 class="mb-1">¡Compra exitosa!</h2>
        <p class="text-muted mb-3">Tu pedido fue confirmado correctamente.</p>
        <p class="mb-4">
          Hemos enviado la confirmación a
          <strong>{{ user.email|default:"tu correo registrado" }}</strong>.
        </p>

        <!-- Resumen del pedido (campos opcionales si el backend aún no los envía) -->
        {% if pedido %}
        <div class="bg-light rounded-3 p-3 text-start mx-auto" style="max-width: 520px;">
          <div class="d-flex justify-content-between py-1">
            <span class="text-muted">Fecha</span>
            <span>{{ pedido.creado|date:"d/m/Y H:i" }}</span>
          </div>
          {% if numero_pedido %}
          <div class="d-flex justify-content-between py-1">
            <span class="text-muted">N° de pedido</span>
            <span>#{{ numero_pedido }}</span>
          </div>
          {% endif %}
          {% if total %}
          <div class="d-flex justify-content-between py-1">
            <span class="text-muted">Total pagado</span>
            <span class="fw-bold text-success">${{ total|floatformat:0 }}</span>
          </div>
          {% endif %}
          
          {% if metodo_pago %}
          <div class="d-flex justify-content-between py-1">
            <span class="text-muted">Método de pago</span>
            <span>{{ metodo_pago }}</span>
          </div>
          {% endif %}
          
          {% if pedido.metodo_entrega %}
          <div class="d-flex justify-content-between py-1">
            <span class="text-muted">Método de entrega</span>
            <span>{{ pedido.get_metodo_entrega_display }}</span>
          </div>
          {% endif %}
        </div>

        <!-- Lista de productos comprados -->
        {% if pedido.items.all %}
        <div class="mt-3">
          <h6 class="fw-semibold mb-2">Productos:</h6>
          <div class="list-group">
            {% for item in pedido.items.all %}
            <div class="list-group-item d-flex justify-content-between align-items-center">
              <div>
                <div class="fw-medium">{{ item.nombre_producto }}</div>
                <small class="text-muted">Cantidad: {{ item.cantidad }} × ${{ item.precio_unitario|floatformat:0 }}</small>
              </div>
              <span class="badge bg-primary rounded-pill">${{ item.precio_unitario|floatformat:0 }}</span>
            </div>
            {% endfor %}
          </div>
        </div>
        {% endif %}
        {% else %}
        <!-- Mensaje cuando no hay pedido disponible aún -->
        <div class="alert alert-info mt-3" role="alert">
          <i class="fa-solid fa-circle-info me-2"></i>
          Tu pago está siendo procesado. Recibirás un correo de confirmación en breve con todos los detalles de tu pedido.
        </div>
        {% endif %}

        <!-- Acciones -->
        <div class="d-flex flex-wrap gap-2 justify-content-center mt-4">
          <a href="{% url 'mis_pedidos' %}" class="btn btn-primary">
            <i class="fa-solid fa-bag-shopping me-2"></i> Ver mis compras
          </a>
          <a href="{% url 'productos' %}" class="btn btn-outline-primary">
            <i class="fa-solid fa-shop me-2"></i> Seguir comprando
          </a>
          {% if comprobante_url %}
          <a href="{{ comprobante_url }}" class="btn btn-outline-secondary" target="_blank" rel="noopener">
            <i class="fa-solid fa-file-arrow-down me-2"></i> Descargar comprobante
          </a>
          {% endif %}
        </div>

        <!-- Aviso -->
        <p class="small text-muted mt-3 mb-0">
          Te notificaremos por correo cada actualización del estado del pedido.
        </p>
      </div>

      <!-- Siguiente paso (informativo) -->
      <div class="card shadow-sm p-3 mt-3">
        <div class="row text-center g-3 align-items-center">
          <div class="col-6 col-md-3">
            <div class="step-dot bg-success-subtle text-success"><i class="fa-solid fa-circle-check"></i></div>
            <div class="step-label">Pago confirmado</div>
          </div>
          <div class="col-6 col-md-3">
            <div class="step-dot"><i class="fa-solid fa-box"></i></div>
            <div class="step-label">Preparación</div>
          </div>
          <div class="col-6 col-md-3">
            <div class="step-dot"><i class="fa-solid fa-truck"></i></div>
            <div class="step-label">En camino</div>
          </div>
          <div class="col-6 col-md-3">
            <div class="step-dot"><i class="fa-solid fa-flag-checkered"></i></div>
            <div class="step-label">Entrega</div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>


<br>
<br>
<br>

<style>
  .success-card { border: 0; border-radius: 12px; }
  .success-icon {
    width: 72px; height: 72px; border-radius: 50%;
    display: grid; place-items: center;
    background: #e9f7ef; color: #198754; font-size: 1.8rem;
  }
  .step-dot {
    width: 44px; height: 44px; border-radius: 50%;
    margin: 0 auto 6px; display: grid; place-items: center;
    background: #f1f5f9; color: #0d6efd;
  }
  .step-label { font-size: .9rem; color: #4b5563; }
</style>

{% endblock %}
