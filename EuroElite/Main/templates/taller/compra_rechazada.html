{% extends 'base.html' %}
{% load static %}
{% block title %}Pago Rechazado - Euro Elite{% endblock %}
{% block content %}

<br>
<br>
<br>
<br>
<br>
<br>

<div class="container my-4">
  <div class="row justify-content-center">
    <div class="col-12 col-lg-8">
      <!-- Mensaje principal de rechazo -->
      <div class="card shadow-sm p-4 text-center rejection-card">
        <div class="rejection-icon mx-auto mb-3">
          <i class="fa-solid fa-times-circle"></i>
        </div>
        <h2 class="mb-1 text-danger">Pago Rechazado</h2>
        <p class="text-muted mb-3">Lo sentimos, tu pago no pudo ser procesado.</p>
        
        {% if motivo_rechazo %}
        <div class="alert alert-warning mx-auto" style="max-width: 520px;">
          <i class="fa-solid fa-exclamation-triangle me-2"></i>
          <strong>Motivo:</strong> {{ motivo_rechazo }}
        </div>
        {% endif %}

        <!-- Resumen del pedido -->
        {% if pedido %}
        <div class="bg-light rounded-3 p-3 text-start mx-auto mt-3" style="max-width: 520px;">
          <div class="d-flex justify-content-between py-1">
            <span class="text-muted">Fecha del intento</span>
            <span>{{ pedido.creado|date:"d/m/Y H:i" }}</span>
          </div>
          {% if numero_pedido %}
          <div class="d-flex justify-content-between py-1">
            <span class="text-muted">N° de pedido</span>
            <span>#{{ numero_pedido }}</span>
          </div>
          {% endif %}
          {% if total %}
          <div class="d-flex justify-content-between py-1">
            <span class="text-muted">Monto intentado</span>
            <span class="fw-bold">${{ total|floatformat:0 }}</span>
          </div>
          {% endif %}
        </div>

        <!-- Lista de productos -->
        {% if pedido.items.all %}
        <div class="mt-3">
          <h6 class="fw-semibold mb-2">Productos en tu pedido:</h6>
          <div class="list-group" style="max-width: 520px; margin: 0 auto;">
            {% for item in pedido.items.all %}
            <div class="list-group-item d-flex justify-content-between align-items-center">
              <div class="text-start">
                <div class="fw-medium">{{ item.nombre_producto }}</div>
                <small class="text-muted">Cantidad: {{ item.cantidad }}</small>
              </div>
              <span class="badge bg-secondary rounded-pill">${{ item.precio_unitario|floatformat:0 }}</span>
            </div>
            {% endfor %}
          </div>
        </div>
        {% endif %}
        {% endif %}

        <!-- Sugerencias -->
        <div class="alert alert-info mx-auto mt-4" style="max-width: 520px;">
          <p class="mb-2"><strong>¿Qué puedes hacer?</strong></p>
          <ul class="text-start mb-0">
            <li>Verifica que tu tarjeta tenga fondos suficientes</li>
            <li>Comprueba los datos de tu tarjeta</li>
            <li>Contacta a tu banco si el problema persiste</li>
            <li>Intenta con otro método de pago</li>
          </ul>
        </div>

        <!-- Acciones -->
        <div class="d-flex flex-wrap gap-2 justify-content-center mt-4">
          <a href="{% url 'carrito_compras' %}" class="btn btn-primary">
            <i class="fa-solid fa-rotate-left me-2"></i> Intentar de nuevo
          </a>
          <a href="{% url 'productos' %}" class="btn btn-outline-primary">
            <i class="fa-solid fa-shop me-2"></i> Seguir comprando
          </a>
          <a href="{% url 'home' %}" class="btn btn-outline-secondary">
            <i class="fa-solid fa-house me-2"></i> Volver al inicio
          </a>
        </div>

        <!-- Contacto -->
        <p class="small text-muted mt-4 mb-0">
          ¿Necesitas ayuda? Contáctanos a <a href="mailto:soporte@euroelite.cl">soporte@euroelite.cl</a>
        </p>
      </div>
    </div>
  </div>
</div>

<br>
<br>
<br>

<style>
  .rejection-card { border: 0; border-radius: 12px; background: #fff; }
  .rejection-icon {
    width: 72px; height: 72px; border-radius: 50%;
    display: grid; place-items: center;
    background: #fee; color: #dc3545; font-size: 1.8rem;
  }
</style>

{% endblock %}
