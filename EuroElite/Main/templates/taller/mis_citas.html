{% extends 'base.html' %}
{% load static %}
{% load tz %}
{% block title %}Mis citas - Euro Elite{% endblock %}
{% block content %}

<br><br><br><br><br><br>

<div class="container my-4 profile-wrapper">
  <div class="row">
    <!-- Sidebar -->
    <aside class="col-12 col-md-3 mb-3">
      <div class="card shadow-sm">
        <div class="card-body">
          <h5 class="mb-1">Hola, {{ user.first_name }}</h5>
          <p class="text-muted" style="font-size: .9rem;">Accede a toda la informaci칩n de tu perfil</p>
          <div class="list-group list-group-flush mt-3">
            <a href="{% url 'perfil' %}" class="list-group-item list-group-item-action">
              <i class="fas fa-id-card me-2"></i> Mis datos
            </a>
            <a href="{% url 'password_reset' %}" class="list-group-item list-group-item-action">
              <i class="fas fa-lock me-2"></i> Contrase침a
            </a>
            <a href="{% url 'mis_citas' %}" class="list-group-item list-group-item-action active">
              <i class="fas fa-calendar-alt me-2"></i> Mis citas
            </a>
            <a href="{% url 'mis_pedidos' %}" class="list-group-item list-group-item-action">
              <i class="fas fa-shopping-bag me-2"></i> Mis compras
            </a>
          </div>
        </div>
      </div>
    </aside>

    <!-- Main content -->
    <section class="col-12 col-md-9" id="ordersSection">
      <h3 class="mb-3">Mis citas</h3>
      <p class="text-muted small">Sesi칩n actual: {{ request.user.email }}</p>


      <!-- 游댳 Mostrar mensajes -->
      {% if messages %}
        <div class="mb-3">
          {% for message in messages %}
            <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
              {{ message }}
              <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            </div>
          {% endfor %}
        </div>
      {% endif %}

      <div class="card shadow-sm p-3">
        {% if citas %}
          {% for c in citas %}
            <div class="order-card shadow-sm mb-3 p-3 rounded-3">
              <div class="row align-items-center gy-3">
                <!-- Izquierda -->
                <div class="col-12 col-md-7 d-flex">
                  <div class="order-image-wrap">
                    <img src="{% static 'img/LogoApp.png' %}" alt="Cita" class="order-image">
                  </div>
                  <div class="ms-3 flex-grow-1">
                    <div class="small fw-semibold mb-1 
                      {% if c.estado == 'COMPLETADA' %}text-success
                      {% elif c.estado == 'CANCELADA' %}text-danger
                      {% elif c.estado == 'EN_PROCESO' or c.get_estado_display == 'En proceso' %}text-warning
                      {% else %}text-primary{% endif %}">
                      {{ c.get_estado_display }}
                    </div>
                    <div class="order-title">
                      Cita el {{ c.bloque.inicio|localtime|date:"j \\de F" }}
                    </div>
                    <div class="order-subtitle">{{ c.servicio.nombre }}</div>
                    <div class="order-subtitle">
                      {{ c.bloque.inicio|localtime|date:"H:i" }}
                    </div>
                    {% if c.a_domicilio %}
                      <div class="order-subtitle">
                        <i class="fas fa-truck"></i> A domicilio ({{ c.direccion_domicilio|default:"Sin direcci칩n" }})
                      </div>
                    {% else %}
                      <div class="order-subtitle">
                        <i class="fas fa-warehouse"></i> En taller
                      </div>
                    {% endif %}
                  </div>
                </div>

                <!-- Acciones -->
                <div class="col-12 col-md-3 text-md-end">
                  {% if c.estado == 'RESERVADA' %}
                    <a class="btn btn-danger btn-sm" href="{% url 'anular_cita' c.id %}">
                      <i class="fas fa-times-circle me-1"></i> Anular
                    </a>
                  {% endif %}
                </div>
              </div>
            </div>
          {% endfor %}
        {% else %}
          <p class="text-center text-muted">No tienes citas agendadas.</p>
        {% endif %}
      </div>
    </section>
  </div>
</div>

<style>
  .profile-wrapper .card {
    border: 0;
    border-radius: 12px;
    box-shadow: var(--shadow);
    background: #fff;
  }
  .profile-wrapper .list-group-item { border: 0; }
  .order-card { background: #fff; border-radius: 12px; padding: 16px; }
  .order-image { width: 72px; height: 72px; object-fit: cover; border-radius: 10px; background: #f8fafc; }
  .order-title { font-weight: 600; font-size: 1.05rem; }
  .order-subtitle { color: #6b7280; font-size: .9rem; }
</style>

{% endblock %}
